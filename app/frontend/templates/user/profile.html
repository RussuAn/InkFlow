{% extends "base.html" %}
{% block title %}{{ user.display_name }} | Профіль{% endblock %}

{% block content %}
<div class="profile-page-wrapper">

    <h1 class="profile-title">
        Мій профіль
    </h1>

    <div class="profile-grid">
        
        <div class="card profile-info-card">
            <div class="profile-avatar-wrapper">
                {% if user.avatar_url %}
                <img src="{{ url_for('static', filename='uploads/avatars/' + user.avatar_url) }}" alt="Avatar" class="profile-avatar-img">
                {% else %}
                <div class="profile-avatar-placeholder">
                    {{ user.username[0].upper() }}
                </div>
                {% endif %}
            </div>
            <h2 class="profile-name">{{ user.display_name }}</h2>
            <p class="profile-username">@{{ user.username }}</p>
            <p class="profile-bio">
                {{ user.bio or 'Користувач ще не додав біографію.' }}
            </p>
            <a href="{{ url_for('user.edit_profile') }}" class="btn-primary" style="padding: 10px 20px; font-weight: 500;">Редагувати</a>
        </div>
        
        <div class="card stat-card wide">
            <svg class="stat-icon flipped" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a5.5 5.5 0 1 1-11 0c0-.397.035-.78.101-1.152-.436.225-.833.524-1.18.887a2.5 2.5 0 0 0 1.579 4.265z"/>
            </svg>
            <div class="stat-value accent">
                {{ user.streak_count }}
            </div>
            <p class="stat-label">Днів поспіль</p>
            <div class="streak-dots">
                {% for i in range(7) %}
                    <div class="streak-dot" style="opacity: {% if loop.index0 < (user.streak_count|default(0) % 7 or 1) %}1{% else %}0.3{% endif %};"></div>
                {% endfor %}
            </div>
        </div>
        
        <div class="card stat-card narrow">
            <svg class="stat-icon balance" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M6 16V4a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H8a2 2 0 0 1-2-2Z"/><path d="M15 6h-6"/><path d="M8 18c-3 0-5 2-5 4"/></svg>
            <div class="stat-value">{{ user.balance or 0 }}</div>
            <p class="stat-label">Монет у гаманці</p>
            <a href="{{ url_for('user.topup') }}" class="btn-primary" style="padding: 10px 25px; font-weight: 500;">Поповнити</a>
        </div>

        <div class="card reading-card">
            <div class="card-header">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#B58A59" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2Z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7Z"/></svg>
                <h3 class="card-title">Читаю зараз</h3>
            </div>
            
            {% if books_reading %}
                <div class="reading-list">
                {% for book in books_reading %}
                    <div class="reading-item">
                        <a href="{{ url_for('books.book_detail', book_id=book.id) }}" class="reading-cover-wrapper">
                            <img src="{{ url_for('static', filename='uploads/covers/' + book.cover_image) }}" alt="{{ book.title }}" style="width: 100%; height: 100%; object-fit: cover;">
                        </a>
                        <div class="reading-info">
                            <a href="{{ url_for('books.book_detail', book_id=book.id) }}" style="text-decoration: none; color: inherit;">
                                <p class="reading-book-title">{{ book.title }}</p>
                            </a>
                            <p class="reading-book-author">{{ book.author }}</p>
                            
                            <a href="{{ url_for('reader.read_book', book_id=book.id) }}" class="btn-secondary" style="padding: 6px 12px; font-size: 0.85rem;">
                                Продовжити читання
                            </a>
                        </div>
                    </div>
                {% endfor %}
                </div>
            {% else %}
                <div class="empty-state">
                    <p>Ця полиця порожня.</p>
                </div>
            {% endif %}
        </div>

        <div class="card completed-card">
            <div class="card-header">
                <div style="display: flex; align-items: center; gap: 12px;">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#B58A59" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 11 12 14 22 4"/><path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"/></svg>
                    <h3 class="card-title">Прочитано</h3>
                </div>
                <span class="count-badge">{{ books_completed|length }} книг</span>
            </div>
            
            {% if books_completed %}
                <div class="mini-grid">
                    {% for book in books_completed %}
                        <a href="{{ url_for('books.book_detail', book_id=book.id) }}" style="text-decoration: none; color: inherit;">
                            <div class="mini-cover">
                                <img src="{{ url_for('static', filename='uploads/covers/' + book.cover_image) }}" alt="{{ book.title }}" style="width: 100%; height: 100%; object-fit: cover;">
                            </div>
                        </a>
                    {% endfor %}
                </div>
            {% else %}
                 <div class="empty-state">
                    <p>Тут відображатимуться ваші завершені книги.</p>
                </div>
            {% endif %}
        </div>

        <div class="card full-width-card">
            <div class="card-header with-border">
                <div style="display: flex; align-items: center; gap: 12px;">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#B58A59" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m19 21-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v16z"/></svg>
                    <h3 class="card-title">Прочитати пізніше</h3>
                </div>
                <span class="count-badge">{{ books_planned|length }} книг</span>
            </div>
            {% if books_planned %}
                <div class="books-grid">
                    {% for book in books_planned %}
                        <a href="{{ url_for('books.book_detail', book_id=book.id) }}" class="grid-book-item">
                            <div class="grid-cover-wrapper">
                                <img src="{{ url_for('static', filename='uploads/covers/' + book.cover_image) }}" alt="{{ book.title }}" style="width: 100%; height: 100%; object-fit: cover;">
                            </div>
                            <p class="grid-book-title">{{ book.title }}</p>
                        </a>
                    {% endfor %}
                </div>
            {% else %}
                 <div class="empty-state"><p>Ви ще не запланували жодної книги.</p></div>
            {% endif %}
        </div>

        <div class="card full-width-card">
            <div class="card-header with-border">
                <div style="display: flex; align-items: center; gap: 12px;">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#B58A59" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 12 20 22 4 22 4 12"/><rect width="20" height="5" x="2" y="7"/><line x1="12" y1="22" x2="12" y2="7"/><path d="M12 7H7.5a2.5 2.5 0 0 1 0-5C11 2 12 7 12 7z"/><path d="M12 7h4.5a2.5 2.5 0 0 0 0-5C13 2 12 7 12 7z"/></svg>
                    <h3 class="card-title">Мої подарунки</h3>
                </div>
                <span class="count-badge">
                    {{ books_gifted|length }} книг
                </span>
            </div>
            
            {% if books_gifted %}
                <div class="books-grid">
                    {% for book in books_gifted %}
                        <a href="{{ url_for('books.book_detail', book_id=book.id) }}" class="grid-book-item">
                            <div class="grid-cover-wrapper">
                                <img src="{{ url_for('static', filename='uploads/covers/' + book.cover_image) }}" alt="{{ book.title }}" style="width: 100%; height: 100%; object-fit: cover;">
                                <div class="gift-badge">
                                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 12 20 22 4 22 4 12"/><rect width="20" height="5" x="2" y="7"/><line x1="12" y1="22" x2="12" y2="7"/><path d="M12 7H7.5a2.5 2.5 0 0 1 0-5C11 2 12 7 12 7z"/><path d="M12 7h4.5a2.5 2.5 0 0 0 0-5C13 2 12 7 12 7z"/></svg>
                                </div>
                            </div>
                            <p class="grid-book-title">{{ book.title }}</p>
                        </a>
                    {% endfor %}
                </div>
            {% else %}
                 <div class="empty-state"><p>Вам ще ніхто не дарував книг.</p></div>
            {% endif %}
        </div>
        
    </div>
</div>
{% endblock %}