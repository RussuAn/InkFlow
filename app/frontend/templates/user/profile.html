{% extends "base.html" %}

{% block title %}{{ user.display_name }} | Профіль{% endblock %}

{% block content %}
<div style="max-width: 1400px; margin: 0 auto; padding: 3rem 0;">

    <h1 style="font-size: 2.5rem; margin-bottom: 2rem; font-family: var(--font-head);">
        Мій Профіль
    </h1>

    <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 1.5rem;">
        
        <div class="profile-card card" style="grid-column: span 1; display: flex; flex-direction: column; align-items: center; text-align: center; padding: 2rem; border-radius: 20px;">
            <div class="avatar-wrapper" style="width: 120px; height: 120px; margin: 0 auto 1.5rem; overflow: hidden; border-radius: 50%; box-shadow: var(--shadow-elevated);">
                {% if user.avatar_url %}
                <img src="{{ url_for('static', filename='uploads/avatars/' + user.avatar_url) }}" alt="Avatar" style="width: 100%; height: 100%; object-fit: cover; display: block;">
                {% else %}
                <div style="width: 100%; height: 100%; background: var(--accent); color: white; display: flex; align-items: center; justify-content: center; font-size: 2.5rem; font-weight: bold;">
                    {{ user.username[0].upper() }}
                </div>
                {% endif %}
            </div>
            <h2 style="font-size: 1.8rem; font-weight: 600; margin-bottom: 0.25rem; line-height: 1.2;">{{ user.display_name }}</h2>
            <p style="color: var(--text-muted); font-size: 1rem; margin-bottom: 1.5rem;">@{{ user.username }}</p>
            <p style="font-size: 0.95rem; line-height: 1.5; color: var(--text-muted); margin-bottom: 1.5rem;">
                {{ user.bio or 'Користувач ще не додав біографію.' }}
            </p>
            <a href="{{ url_for('user.edit_profile') }}" class="btn-primary" style="padding: 10px 20px; font-weight: 500;">Редагувати</a>
        </div>
        
        <div class="stat-card card" style="grid-column: span 2; display: flex; flex-direction: column; align-items: center; justify-content: center; border-radius: 20px;">
            <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="color: var(--accent); margin-bottom: 0.5rem; transform: scaleX(-1);">
                <path d="M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a5.5 5.5 0 1 1-11 0c0-.397.035-.78.101-1.152-.436.225-.833.524-1.18.887a2.5 2.5 0 0 0 1.579 4.265z"/>
            </svg>
            
            <div style="font-family: var(--font-head); font-size: 3rem; font-weight: 600; color: var(--accent); margin-bottom: 0.5rem;">
                {{ user.streak_count }}
            </div>
            <p style="color: var(--text-muted); font-size: 1.125rem; margin-bottom: 1.5rem;">Днів поспіль</p>
            <div style="display: flex; gap: 4px;">
                {% for i in range(7) %}
                    <div style="width: 20px; height: 20px; border-radius: 4px; background-color: var(--accent); opacity: {% if loop.index0 < (user.streak_count|default(0) % 7 or 1) %}1{% else %}0.3{% endif %};"></div>
                {% endfor %}
            </div>
        </div>
        
        <div class="stat-card card" style="grid-column: span 1; display: flex; flex-direction: column; align-items: center; justify-content: center; border-radius: 20px;">
            <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="#B58A59" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-bottom: 0.5rem;"><path d="M6 16V4a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H8a2 2 0 0 1-2-2Z"/><path d="M15 6h-6"/><path d="M8 18c-3 0-5 2-5 4"/></svg>
            <div style="font-family: var(--font-head); font-size: 3rem; font-weight: 600; margin-bottom: 0.5rem;">{{ user.balance or 0 }}</div>
            <p style="color: var(--text-muted); font-size: 1.125rem; margin-bottom: 1.5rem;">Монет у гаманці</p>
            <a href="{{ url_for('user.topup') }}" class="btn-primary" style="padding: 10px 25px; font-weight: 500;">Поповнити</a>
        </div>

        <div class="reading-now-card card" style="grid-column: span 2; padding: 2rem; border-radius: 20px; max-height: 400px; overflow-y: auto;">
            <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 1.5rem;">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#B58A59" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2Z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7Z"/></svg>
                <h3 style="font-size: 1.5rem; margin: 0; font-family: var(--font-head);">Читаю зараз</h3>
            </div>
            
            {% if books_reading %}
                <div style="display: flex; flex-direction: column; gap: 1.5rem;">
                {% for book in books_reading %}
                    <div style="display: flex; gap: 1.5rem; align-items: flex-start; padding-bottom: 1rem; border-bottom: 1px solid var(--border);">
                        <a href="{{ url_for('books.book_detail', book_id=book.id) }}" style="flex-shrink: 0; width: 80px; aspect-ratio: 2/3; border-radius: 8px; overflow: hidden; box-shadow: var(--shadow);">
                            <img src="{{ url_for('static', filename='uploads/covers/' + book.cover_image) }}" alt="{{ book.title }}" style="width: 100%; height: 100%; object-fit: cover;">
                        </a>
                        <div style="flex-grow: 1;">
                            <a href="{{ url_for('books.book_detail', book_id=book.id) }}" style="text-decoration: none; color: inherit;">
                                <p style="font-family: var(--font-head); font-size: 1.125rem; font-weight: 600; margin-bottom: 0.25rem;">{{ book.title }}</p>
                            </a>
                            <p style="color: var(--text-muted); font-size: 0.9rem; margin-bottom: 0.75rem;">{{ book.author }}</p>
                            
                            <a href="{{ url_for('reader.read_book', book_id=book.id) }}" class="btn-secondary" style="padding: 6px 12px; font-size: 0.85rem;">
                                Продовжити читання
                            </a>
                        </div>
                    </div>
                {% endfor %}
                </div>
            {% else %}
                <div style="color: var(--text-muted); padding: 1rem 0;">
                    <p>Ця полиця порожня.</p>
                </div>
            {% endif %}
        </div>

        <div class="completed-books-card card" style="grid-column: span 2; padding: 2rem; border-radius: 20px;">
            <div style="display: flex; align-items: center; justify-content: space-between; gap: 12px; margin-bottom: 1.5rem;">
                <div style="display: flex; align-items: center; gap: 12px;">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#B58A59" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 11 12 14 22 4"/><path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"/></svg>
                    <h3 style="font-size: 1.5rem; margin: 0; font-family: var(--font-head);">Прочитано</h3>
                </div>
                <span style="color: var(--text-main); background: var(--border); padding: 4px 10px; border-radius: 8px; font-weight: 600; font-size: 0.85rem;">{{ books_completed|length }} книг</span>
            </div>
            
            {% if books_completed %}
                <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(60px, 1fr)); gap: 10px;">
                    {% for book in books_completed %}
                        <a href="{{ url_for('books.book_detail', book_id=book.id) }}" style="text-decoration: none; color: inherit; transition: transform 0.2s;" onmouseover="this.style.transform='translateY(-3px)'" onmouseout="this.style.transform='translateY(0)'">
                            <div style="aspect-ratio: 3/4; overflow: hidden; border-radius: 8px; box-shadow: var(--shadow);">
                                <img src="{{ url_for('static', filename='uploads/covers/' + book.cover_image) }}" alt="{{ book.title }}" style="width: 100%; height: 100%; object-fit: cover;">
                            </div>
                        </a>
                    {% endfor %}
                </div>
            {% else %}
                 <div style="color: var(--text-muted); padding: 1rem 0;">
                    <p>Тут відображатимуться ваші завершені книги.</p>
                </div>
            {% endif %}
        </div>

        <div class="card" style="grid-column: 1 / -1; padding: 2rem; border-radius: 20px;">
            <div style="display: flex; align-items: center; justify-content: space-between; gap: 12px; margin-bottom: 1.5rem; border-bottom: 1px solid var(--border); padding-bottom: 1rem;">
                <div style="display: flex; align-items: center; gap: 12px;">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#B58A59" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m19 21-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v16z"/></svg>
                    <h3 style="font-size: 1.5rem; margin: 0; font-family: var(--font-head);">Прочитати пізніше</h3>
                </div>
                <span style="color: var(--text-main); background: var(--border); padding: 4px 10px; border-radius: 8px; font-weight: 600; font-size: 0.85rem;">{{ books_planned|length }} книг</span>
            </div>
            {% if books_planned %}
                <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(120px, 1fr)); gap: 1.5rem;">
                    {% for book in books_planned %}
                        <a href="{{ url_for('books.book_detail', book_id=book.id) }}" style="text-decoration: none; color: inherit; display: block; transition: transform 0.2s;" onmouseover="this.style.transform='translateY(-5px)'" onmouseout="this.style.transform='translateY(0)'">
                            <div style="aspect-ratio: 3/4; overflow: hidden; border-radius: 12px; box-shadow: var(--shadow); margin-bottom: 0.5rem;">
                                <img src="{{ url_for('static', filename='uploads/covers/' + book.cover_image) }}" alt="{{ book.title }}" style="width: 100%; height: 100%; object-fit: cover;">
                            </div>
                            <p style="font-size: 0.9rem; font-weight: 600; line-height: 1.2; text-align: center; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden;">{{ book.title }}</p>
                        </a>
                    {% endfor %}
                </div>
            {% else %}
                 <div style="color: var(--text-muted); padding: 1rem 0;"><p>Ви ще не запланували жодної книги.</p></div>
            {% endif %}
        </div>
        
    </div>
</div>
{% endblock %}