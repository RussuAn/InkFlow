{% extends "base.html" %}
{% block title %}Редагувати профіль | InkFlow{% endblock %}

{% block content %}
<div style="max-width: 1000px; margin: 0 auto; padding: 3rem 0;">
    
    <h1 style="font-size: 2.5rem; margin-bottom: 2rem; font-family: var(--font-head);">Редагувати профіль</h1>

    <form method="POST" enctype="multipart/form-data" action="{{ url_for('user.edit_profile') }}">
        {{ form.csrf_token }}
        
        <div class="card edit-profile-card" style="padding: 2.5rem; border-radius: 20px; box-shadow: var(--shadow-elevated);">
            
            <div style="display: grid; grid-template-columns: 1fr 2fr; gap: 3rem;">
                
                <div style="text-align: center; border-right: 1px solid var(--border); padding-right: 2rem;">
                    
                    <h3 style="font-size: 1.2rem; margin-bottom: 1.5rem; color: var(--text-muted);">Аватар користувача</h3>

                    <div 
                        class="avatar-preview-wrapper" 
                        style="width: 150px; height: 150px; margin: 0 auto 1.5rem; overflow: hidden; border-radius: 50%; border: 4px solid var(--accent-light); box-shadow: var(--shadow);"
                    >
                        {% if current_user.avatar_url %}
                        <img id="avatar-preview" src="{{ url_for('static', filename='uploads/avatars/' + current_user.avatar_url) }}" alt="Avatar" style="width: 100%; height: 100%; object-fit: cover; display: block;">
                        {% else %}
                        <div id="avatar-preview" style="width: 100%; height: 100%; background: var(--accent); color: white; display: flex; align-items: center; justify-content: center; font-size: 3rem; font-weight: bold;">
                            {{ current_user.username[0].upper() }}
                        </div>
                        {% endif %}
                    </div>

                    <label for="{{ form.avatar.id }}" class="btn-secondary" style="cursor: pointer; padding: 10px 25px; font-weight: 500; display: inline-flex; align-items: center;">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right: 8px;"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>
                        Обрати файл
                    </label>
                    <input 
                        type="file" 
                        id="{{ form.avatar.id }}" 
                        name="{{ form.avatar.name }}" 
                        accept="image/*"
                        onchange="previewAvatar(this)"
                        style="display: none;"
                    >
                    {% for error in form.avatar.errors %}
                        <span class="form-error" style="margin-top: 0.5rem;">{{ error }}</span>
                    {% endfor %}
                    <p id="avatar-file-name" class="form-hint" style="margin-top: 0.75rem;">
                         {% if current_user.avatar_url %}Завантажено: {{ current_user.avatar_url }}{% else %}Не завантажено{% endif %}
                    </p>
                </div>
                
                <div style="padding-top: 0.5rem;">
                    
                    <div style="margin-bottom: 1.5rem;">
                        <label for="{{ form.display_name.id }}" class="input-label">Ім'я для відображення</label>
                        {{ form.display_name(class="form-input", placeholder="Анна Мельник") }}
                        {% for error in form.display_name.errors %}
                            <span class="form-error">{{ error }}</span>
                        {% endfor %}
                    </div>

                    <div style="margin-bottom: 1.5rem;">
                        <label for="{{ form.username.id }}" class="input-label">Нікнейм (унікальний)</label>
                        {{ form.username(class="form-input", placeholder="anna_reader") }}
                        <p class="form-hint">Нікнейм має бути унікальним та містити лише літери, цифри та підкреслення.</p>
                        {% for error in form.username.errors %}
                            <span class="form-error">{{ error }}</span>
                        {% endfor %}
                    </div>

                    <div style="margin-bottom: 2rem;">
                        <label for="{{ form.bio.id }}" class="input-label">Про себе</label>
                        {{ form.bio(class="form-input", rows="4", placeholder="Любитель класичної літератури та філософії", oninput="updateBioCounter(this)") }}
                        <p id="bio-counter" class="form-hint">{{ current_user.bio|length if current_user.bio else 0 }}/500 символів</p>
                        {% for error in form.bio.errors %}
                            <span class="form-error">{{ error }}</span>
                        {% endfor %}
                    </div>
                    
                    <div style="margin-bottom: 2rem; border-top: 1px solid var(--border); padding-top: 1.5rem;">
                        <label class="input-label" style="color: var(--text-muted);">Електронна пошта (не можна змінити)</label>
                        <input type="email" value="{{ current_user.email }}" class="form-input-disabled" disabled>
                    </div>

                </div>
            </div>

            <div style="display: flex; justify-content: flex-end; gap: 1rem; padding-top: 1.5rem; border-top: 1px solid var(--border);">
                <a href="{{ url_for('user.profile') }}" class="btn-secondary" style="padding: 10px 25px; font-weight: 500;">
                    Скасувати
                </a>
                <button type="submit" class="btn-primary" style="padding: 10px 25px; font-weight: 500;">
                    Зберегти зміни
                </button>
            </div>
            
        </div>
    </form>
</div>

<script src="{{ url_for('static', filename='js/edit_profile.js') }}"></script>
{% endblock %}