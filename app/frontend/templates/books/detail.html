{% extends "base.html" %}

{% block title %}{{ book.title }} | –î–µ—Ç–∞–ª—ñ –∫–Ω–∏–≥–∏{% endblock %}

{% block content %}
<div style="max-width: 1200px; margin: 0 auto; padding: 2rem 0;">
    
    <a href="{{ url_for('index') }}" style="display: flex; align-items: center; gap: 8px; color: var(--text-muted); text-decoration: none; font-weight: 500; margin-bottom: 2rem; font-size: 1rem;">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m15 18-6-6 6-6"/></svg>
        –ù–∞–∑–∞–¥ –¥–æ –∫–∞—Ç–∞–ª–æ–≥—É
    </a>

    <div style="display: grid; grid-template-columns: 400px 1fr; gap: 4rem; margin-bottom: 4rem; align-items: start;">
        
        <div style="width: 100%; aspect-ratio: 3/4; border-radius: 24px; overflow: hidden; box-shadow: var(--shadow-elevated); background: var(--bg-card);">
            <img 
                src="{{ url_for('static', filename='uploads/covers/' + book.cover_image) }}" 
                alt="{{ book.title }}" 
                style="width: 100%; height: 100%; object-fit: cover; display: block;"
            >
        </div>

        <div style="display: flex; flex-direction: column; justify-content: center; padding-top: 0.5rem;">
            
            <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 0.5rem;">
                <span style="color: var(--accent); font-size: 0.9rem; font-weight: 600; text-transform: uppercase; letter-spacing: 0.05em; margin-top: 10px;">
                    {{ book.genre or '–ñ–∞–Ω—Ä' }}
                </span>
                {% if current_user.is_authenticated %}
                <div style="display: flex; gap: 10px;">
                    <a href="{{ url_for('library.update_status', book_id=book.id, status='planned') }}" class="btn-icon-square {% if current_status == 'planned' %}active{% endif %}" title="{% if current_status == 'planned' %}–£ –ø–ª–∞–Ω–∞—Ö{% else %}–ü—Ä–æ—á–∏—Ç–∞—Ç–∏ –ø—ñ–∑–Ω—ñ—à–µ{% endif %}">
                        <svg width="22" height="22" viewBox="0 0 24 24" fill="{% if current_status == 'planned' %}currentColor{% else %}none{% endif %}" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m19 21-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v16z"/></svg>
                    </a>
                    {% if current_status %}
                    <a href="{{ url_for('library.remove_book', book_id=book.id) }}" class="btn-icon-square destructive" title="–ü—Ä–∏–±—Ä–∞—Ç–∏ –∑ –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∏">
                        <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><line x1="15" y1="9" x2="9" y2="15"/><line x1="9" y1="9" x2="15" y2="15"/></svg>
                    </a>
                    {% endif %}
                </div>
                {% endif %}
            </div>

            <h1 style="font-size: 3.5rem; margin-bottom: 0.5rem; line-height: 1.1; font-family: var(--font-head); color: var(--text-main);">{{ book.title }}</h1>
            <p style="font-size: 1.25rem; color: var(--text-muted); margin-bottom: 1.5rem;">{{ book.author }}</p>
            
            <div style="margin-bottom: 2.5rem; position: relative;">
                <div id="description-box" class="description-wrapper collapsed">
                    <p style="font-size: 1.05rem; line-height: 1.6; color: var(--text-muted); white-space: pre-wrap; word-break: break-word; margin: 0;">{{ book.description }}</p>
                </div>
                <button id="description-toggle" class="desc-toggle-btn" title="–†–æ–∑–≥–æ—Ä–Ω—É—Ç–∏ –æ–ø–∏—Å">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="1"/><circle cx="19" cy="12" r="1"/><circle cx="5" cy="12" r="1"/></svg>
                </button>
            </div>

            <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 1rem; margin-bottom: 2.5rem;">
                <div class="meta-card"><span class="meta-label">–°—Ç–æ—Ä—ñ–Ω–æ–∫</span><span class="meta-value">{{ book.page_count if book.page_count > 0 else '---' }}</span></div>
                <div class="meta-card"><span class="meta-label">–†–µ–π—Ç–∏–Ω–≥</span><div style="display: flex; align-items: center; gap: 6px;"><svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor" style="color: var(--accent);"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg><span class="meta-value">{% if reviews %}{{ (reviews|sum(attribute='rating') / reviews|length)|round(1) }}{% else %}---{% endif %}</span></div></div>
                <div class="meta-card"><span class="meta-label">–§–æ—Ä–º–∞—Ç</span><span class="meta-value">{% if book.file_path %}{{ book.file_path.split('.')[-1] | upper }}{% else %}---{% endif %}</span></div>
                <div class="meta-card"><span class="meta-label">–†—ñ–∫</span><span class="meta-value">{{ book.created_at.strftime('%Y') }}</span></div>
            </div>

            <div style="display: flex; flex-direction: column; gap: 1rem; width: 100%;">
                <a href="{{ url_for('reader.read_book', book_id=book.id) }}" class="btn-primary action-btn-large">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2Z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7Z"/></svg>
                    –ß–∏—Ç–∞—Ç–∏ –æ–Ω–ª–∞–π–Ω
                </a>

                {% if current_user.is_authenticated %}
                    <div style="display: flex; gap: 1rem; width: 100%;">
                        {% if is_owned %}
                            <a href="{{ url_for('static', filename='uploads/books/' + book.file_path) }}" download class="btn-secondary action-btn-large" style="flex: 1; justify-content: center;">
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
                                –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ —Ñ–∞–π–ª
                            </a>
                        {% else %}
                            <a href="{{ url_for('books.buy_book_route', book_id=book.id) }}" class="btn-secondary action-btn-large" style="flex: 1; justify-content: center;">
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
                                {% if book.price_coins == 0 %}–û—Ç—Ä–∏–º–∞—Ç–∏ –±–µ–∑–∫–æ—à—Ç–æ–≤–Ω–æ{% else %}–ö—É–ø–∏—Ç–∏ –∑–∞ {{ book.price_coins }} ü™ô{% endif %}
                            </a>
                        {% endif %}
                        
                        {% if book.price_coins > 0 %}
                        <button onclick="openGiftModal()" class="btn-secondary action-btn-large" style="width: auto; aspect-ratio: 1/1; flex-shrink: 0; display: flex; align-items: center; justify-content: center;" title="–ü–æ–¥–∞—Ä—É–≤–∞—Ç–∏ –¥—Ä—É–≥—É">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="var(--accent)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 12 20 22 4 22 4 12"/><rect width="20" height="5" x="2" y="7"/><line x1="12" y1="22" x2="12" y2="7"/><path d="M12 7H7.5a2.5 2.5 0 0 1 0-5C11 2 12 7 12 7z"/><path d="M12 7h4.5a2.5 2.5 0 0 0 0-5C13 2 12 7 12 7z"/></svg>
                        </button>
                        {% endif %}
                    </div>
                {% else %}
                    <a href="{{ url_for('auth.login', next=request.path) }}" class="btn-secondary action-btn-large">
                        –£–≤—ñ–π—Ç–∏ –¥–ª—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è
                    </a>
                {% endif %}
            </div>

        </div>
    </div>
    
    <div class="card" style="padding: 3rem; border-radius: 24px; box-shadow: var(--shadow); background: var(--bg-card);">
        <h2 style="font-size: 2rem; margin-bottom: 2rem; font-family: var(--font-head); color: var(--text-main);">
            –í—ñ–¥–≥—É–∫–∏ —á–∏—Ç–∞—á—ñ–≤
            <span style="margin-left: 10px; color: var(--border); font-size: 1.5rem;">‚òÜ‚òÜ‚òÜ‚òÜ‚òÜ</span>
        </h2>

        {% if current_user.is_authenticated %}
            <form method="POST" action="{{ url_for('books.book_detail', book_id=book.id) }}" style="margin-bottom: 3rem; padding-bottom: 2rem; border-bottom: 1px solid var(--border);">
                {{ review_form.hidden_tag() }}
                <div style="margin-bottom: 1.5rem;">{{ review_form.comment(class="review-textarea", placeholder="–ü–æ–¥—ñ–ª—ñ—Ç—å—Å—è –≤—Ä–∞–∂–µ–Ω–Ω—è–º–∏ –ø—Ä–æ –∫–Ω–∏–≥—É...", rows="4") }}</div>
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <div class="interactive-rating">
                        <input type="hidden" name="rating" id="rating-value" value="5">
                        <div class="stars-container">
                            {% for i in range(1, 6) %}<svg class="star-icon" data-value="{{ i }}" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="cursor: pointer; color: var(--border); transition: color 0.2s;"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>{% endfor %}
                        </div>
                    </div>
                    <button type="submit" class="btn-primary" style="padding: 12px 30px; font-size: 1rem; border-radius: 24px;">–î–æ–¥–∞—Ç–∏ –≤—ñ–¥–≥—É–∫</button>
                </div>
            </form>
        {% endif %}

        <div style="display: flex; flex-direction: column; gap: 2.5rem;">
            {% for review in reviews %}
            <div style="padding-bottom: 2.5rem; border-bottom: 1px solid var(--border); last:border-bottom: none;">
                <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 0.5rem;">
                    <span style="font-weight: 700; font-size: 1.1rem; color: var(--text-main);">{{ review.display_name or review.username }}</span>
                    <div style="display: flex; gap: 4px;">{% for i in range(1, 6) %}<svg width="18" height="18" viewBox="0 0 24 24" fill="{% if i <= review.rating %}currentColor{% else %}none{% endif %}" stroke="currentColor" stroke-width="2" style="color: var(--accent);"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>{% endfor %}</div>
                </div>
                <p style="color: var(--text-muted); line-height: 1.6; margin-bottom: 0.5rem;">{{ review.comment }}</p>
                <span style="font-size: 0.85rem; color: var(--text-muted);">{{ review.created_at.strftime('%d –ª–∏—Å—Ç–æ–ø–∞–¥–∞ %Y') }}</span>
            </div>
            {% endfor %}
        </div>
    </div>

    {% if current_user.is_authenticated and current_user.role == 'admin' %}
        <div style="text-align: center; margin-top: 5rem; padding-top: 2rem; border-top: 1px solid var(--border);">
            <form method="POST" action="{{ url_for('books.delete_book_route', book_id=book.id) }}" onsubmit="return confirm('–í–∏ –≤–ø–µ–≤–Ω–µ–Ω—ñ, —â–æ —Ö–æ—á–µ—Ç–µ –≤–∏–¥–∞–ª–∏—Ç–∏ —Ü—é –∫–Ω–∏–≥—É? –¶—è –¥—ñ—è –Ω–µ–∑–≤–æ—Ä–æ—Ç–Ω—è.');" style="display: inline-block;">
                <input type="hidden" name="csrf_token" value="{{ review_form.csrf_token.current_token }}">
                <button type="submit" class="btn-danger" style="padding: 14px 40px; font-size: 1rem; border-radius: 16px; display: flex; align-items: center; gap: 10px;">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/><line x1="10" y1="11" x2="10" y2="17"/><line x1="14" y1="11" x2="14" y2="17"/></svg>
                    –í–∏–¥–∞–ª–∏—Ç–∏ –∫–Ω–∏–≥—É
                </button>
            </form>
        </div>
    {% endif %}

</div>

{% if book.price_coins > 0 %}
<div id="gift-modal" class="modal-overlay" style="display: none;">
    <div class="modal-content card" style="padding: 3rem; border-radius: 24px; max-width: 480px; text-align: center; position: relative;">
        <button class="close-modal" onclick="closeGiftModal()" style="position: absolute; top: 20px; right: 20px; background: none; border: none; font-size: 1.5rem; cursor: pointer; color: var(--text-muted);"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg></button>
        <div style="margin: 0 auto 1rem auto; width: 80px; height: 80px; border-radius: 50%; background: var(--input-bg); display: flex; align-items: center; justify-content: center; color: var(--accent);"><svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 12 20 22 4 22 4 12"/><rect width="20" height="5" x="2" y="7"/><line x1="12" y1="22" x2="12" y2="7"/><path d="M12 7H7.5a2.5 2.5 0 0 1 0-5C11 2 12 7 12 7z"/><path d="M12 7h4.5a2.5 2.5 0 0 0 0-5C13 2 12 7 12 7z"/></svg></div>
        <h3 style="margin: 0; font-size: 2rem; margin-bottom: 0.5rem; font-family: var(--font-head);">–ó—Ä–æ–±–∏—Ç–∏ –ø–æ–¥–∞—Ä—É–Ω–æ–∫</h3>
        <p style="color: var(--text-muted); font-size: 1rem; margin-bottom: 2rem;">–í–≤–µ–¥—ñ—Ç—å –Ω—ñ–∫–Ω–µ–π–º –¥—Ä—É–≥–∞, —â–æ–± –ø–æ–¥–∞—Ä—É–≤–∞—Ç–∏ –∫–Ω–∏–≥—É "{{ book.title }}"</p>
        <form action="{{ url_for('books.gift_book_route', book_id=book.id) }}" method="POST">
            <input type="hidden" name="csrf_token" value="{{ review_form.csrf_token.current_token }}">
            <div style="margin-bottom: 1.5rem; text-align: left;">
                <label style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: var(--text-main);">–ù—ñ–∫–Ω–µ–π–º</label>
                <input type="text" name="recipient_username" placeholder="@username" required style="width: 100%; padding: 14px 14px 14px 35px; border-radius: 12px; border: 1px solid var(--border); background: var(--input-bg); color: var(--text-main); outline: none; font-size: 1rem;">
            </div>
            <div style="background: var(--input-bg); padding: 14px; border-radius: 12px; font-size: 0.95rem; color: var(--text-muted); margin-bottom: 2rem;">
                –í–∞—Ä—Ç—ñ—Å—Ç—å –ø–æ–¥–∞—Ä—É–Ω–∫–∞: <strong style="color: var(--text-main);">{{ book.price_coins }} ü™ô</strong>
            </div>
            <button type="submit" class="btn-primary" style="width: 100%; padding: 14px; font-size: 1.1rem; border-radius: 12px;">–ù–∞–¥—ñ—Å–ª–∞—Ç–∏ –ø–æ–¥–∞—Ä—É–Ω–æ–∫</button>
        </form>
    </div>
</div>
{% endif %}

<style>
    /* –ù–û–í–Ü –°–¢–ò–õ–Ü –î–õ–Ø –û–ü–ò–°–£ */
    .description-wrapper {
        transition: max-height 0.3s ease;
        overflow: hidden;
        position: relative;
    }
    .description-wrapper.collapsed {
        max-height: 120px; /* –ü–æ–∫–∞–∑—É—î–º–æ ~5 —Ä—è–¥–∫—ñ–≤ */
        mask-image: linear-gradient(to bottom, black 60%, transparent 100%);
        -webkit-mask-image: linear-gradient(to bottom, black 60%, transparent 100%);
    }
    .description-wrapper.expanded {
        max-height: 300px; /* –§—ñ–∫—Å–æ–≤–∞–Ω–∞ –≤–∏—Å–æ—Ç–∞ —Ä–æ–∑–≥–æ—Ä–Ω—É—Ç–æ–≥–æ –±–ª–æ–∫—É */
        overflow-y: auto;  /* –í–º–∏–∫–∞—î–º–æ —Å–∫—Ä–æ–ª */
        mask-image: none;
        -webkit-mask-image: none;
        padding-right: 10px;
    }
    .desc-toggle-btn {
        width: 100%; background: transparent; border: none; color: var(--text-muted);
        cursor: pointer; padding: 5px; margin-top: 5px; display: flex; justify-content: center;
        transition: color 0.2s;
    }
    .desc-toggle-btn:hover { color: var(--accent); }

    /* –†–ï–®–¢–ê –°–¢–ò–õ–Ü–í */
    .btn-icon-square { display: flex; align-items: center; justify-content: center; width: 48px; height: 48px; border-radius: 14px; background-color: var(--bg-card); border: 1px solid var(--border); color: var(--text-muted); cursor: pointer; transition: all 0.2s; box-shadow: var(--shadow); }
    .btn-icon-square:hover { transform: translateY(-2px); box-shadow: var(--shadow-elevated); color: var(--text-main); }
    .btn-icon-square.active { background-color: var(--accent); color: white; border-color: var(--accent); }
    .btn-icon-square.destructive:hover { border-color: #EF4444; color: #EF4444; }
    .meta-card { background: var(--bg-card); border: 1px solid var(--border); border-radius: 16px; padding: 1.25rem; display: flex; flex-direction: column; gap: 0.5rem; }
    .meta-label { font-size: 0.9rem; color: var(--text-muted); }
    .meta-value { font-size: 1.4rem; font-weight: 700; color: var(--text-main); }
    .action-btn-large { display: flex; align-items: center; justify-content: center; gap: 12px; padding: 18px; border-radius: 16px; font-size: 1.15rem; font-weight: 600; width: 100%; text-decoration: none; cursor: pointer; border: 1px solid transparent; transition: transform 0.2s, box-shadow 0.2s; }
    .action-btn-large:hover { transform: translateY(-2px); box-shadow: var(--shadow-elevated); }
    .btn-secondary { background-color: var(--input-bg); border-color: var(--border); color: var(--text-main); }
    .review-textarea { width: 100%; padding: 1.5rem; border-radius: 16px; border: 1px solid var(--border); background: var(--input-bg); color: var(--text-main); font-family: inherit; font-size: 1rem; resize: none; outline: none; }
    .review-textarea:focus { border-color: var(--accent); }
    .stars-container { display: flex; gap: 4px; }
    .star-icon.filled { fill: var(--accent); color: var(--accent) !important; }
    .modal-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background-color: rgba(0, 0, 0, 0.6); z-index: 9999; display: flex; align-items: center; justify-content: center; backdrop-filter: blur(5px); }
    .bookmark-btn { background: transparent; border: none; cursor: pointer; color: var(--text-muted); transition: color 0.2s; padding: 5px; }
    .bookmark-btn.active { color: var(--accent); fill: var(--accent); }
    .bookmark-btn:hover { color: var(--accent); }
</style>

<script>
    // –°–∫—Ä–∏–ø—Ç –¥–ª—è –∑–≥–æ—Ä—Ç–∞–Ω–Ω—è –æ–ø–∏—Å—É
    document.addEventListener('DOMContentLoaded', () => {
        const descBox = document.getElementById('description-box');
        const toggleBtn = document.getElementById('description-toggle');
        
        if (descBox && toggleBtn) {
            if (descBox.scrollHeight <= 120) {
                toggleBtn.style.display = 'none';
                descBox.classList.remove('collapsed');
                descBox.style.maskImage = 'none';
            }

            toggleBtn.addEventListener('click', () => {
                if (descBox.classList.contains('collapsed')) {
                    descBox.classList.remove('collapsed');
                    descBox.classList.add('expanded');
                    toggleBtn.innerHTML = '<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="18 15 12 9 6 15"/></svg>';
                } else {
                    descBox.classList.remove('expanded');
                    descBox.classList.add('collapsed');
                    descBox.scrollTop = 0;
                    toggleBtn.innerHTML = '<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="1"/><circle cx="19" cy="12" r="1"/><circle cx="5" cy="12" r="1"/></svg>';
                }
            });
        }
    });

    const modal = document.getElementById('gift-modal');
    function openGiftModal() { if(modal) modal.style.display = 'flex'; }
    function closeGiftModal() { if(modal) modal.style.display = 'none'; }
    if(modal) modal.addEventListener('click', (e) => { if (e.target === modal) closeGiftModal(); });

    document.addEventListener('DOMContentLoaded', () => {
        const stars = document.querySelectorAll('.star-icon');
        const ratingInput = document.getElementById('rating-value');
        let currentRating = 5;
        function updateStars(value) {
            stars.forEach(star => {
                const starVal = parseInt(star.dataset.value);
                if (starVal <= value) { star.classList.add('filled'); } else { star.classList.remove('filled'); }
            });
        }
        updateStars(currentRating);
        stars.forEach(star => {
            star.addEventListener('click', () => { currentRating = parseInt(star.dataset.value); ratingInput.value = currentRating; updateStars(currentRating); });
            star.addEventListener('mouseenter', () => { updateStars(parseInt(star.dataset.value)); });
            star.addEventListener('mouseleave', () => { updateStars(currentRating); });
        });
    });
</script>
{% endblock %}