{% extends "base.html" %}
{% block title %}Читаю: {{ book.title }}{% endblock %}

{% block navbar %}{% endblock %}
{% block footer %}{% endblock %} 

{% block content %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/reader.css') }}">

<div class="reader-layout">
    
    <div class="reader-toolbar">
        <div class="toolbar-left">
            <a href="{{ url_for('books.book_detail', book_id=book.id) }}" class="back-link" title="Вийти з читалки">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m15 18-6-6 6-6"/></svg>
                <span>Назад</span>
            </a>
            <span class="book-title-header">{{ book.title }}</span>
        </div>

        <div class="toolbar-center">
            <button id="prev-btn" class="nav-btn" title="Попередня сторінка">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m15 18-6-6 6-6"/></svg>
            </button>
            
            <div class="page-display">
                <input type="number" id="page-num-input" value="{{ start_page }}" min="1" class="page-input">
                <span class="page-divider">/</span>
                <span id="page-count" class="page-total">--</span>
            </div>
            
            <button id="next-btn" class="nav-btn" title="Наступна сторінка">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m9 18 6-6-6-6"/></svg>
            </button>
        </div>

        <div class="toolbar-right">
            <div class="zoom-controls">
                <button id="zoom-out-btn" class="nav-btn" title="Зменшити">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/><line x1="8" y1="11" x2="14" y2="11"/></svg>
                </button>
                <span id="zoom-display" class="zoom-value">100%</span>
                <button id="zoom-in-btn" class="nav-btn" title="Збільшити">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/><line x1="11" y1="8" x2="11" y2="14"/><line x1="8" y1="11" x2="14" y2="11"/></svg>
                </button>
            </div>
            
            <button id="reader-theme-toggle" class="nav-btn theme-btn" title="Змінити тему">
                <svg class="moon-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"></path></svg>
                <svg class="sun-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display: none;"><circle cx="12" cy="12" r="4"></circle><path d="M12 2v2"></path><path d="M12 20v2"></path><path d="m4.93 4.93 1.41 1.41"></path><path d="m17.66 17.66 1.41 1.41"></path><path d="M2 12h2"></path><path d="M20 12h2"></path><path d="m6.34 17.66-1.41 1.41"></path><path d="m19.07 4.93-1.41 1.41"></path></svg>
            </button>
        </div>
    </div>

    <div id="viewer-container" class="viewer-container"></div>

    <div class="floating-help">
        <span class="help-text">Навігація:</span>
        <kbd class="key">←</kbd> <kbd class="key">→</kbd>
    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.min.js"></script>

<script>
    window.readerConfig = {
        url: "{{ url_for('static', filename='uploads/books/' + book.file_path) }}",
        startPage: {{ start_page }},
        bookId: {{ book.id }},
        saveUrl: "{{ url_for('reader.save_progress') }}",
        finishUrl: "{{ url_for('reader.finish_book') }}",
        profileUrl: "{{ url_for('user.profile') }}"
    };
</script>
<script src="{{ url_for('static', filename='js/reader_init.js') }}"></script>
<script src="{{ url_for('static', filename='js/reader.js') }}"></script>
{% endblock %}